<html>
  <head>
    <title>Chrono Test</title>
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.4.3/jquery.min.js"></script>
    <script type="text/javascript" src="protovis.js"></script>
  </head>
  <body>
    <script type="text/javascript+protovis">
    
    var w = 960,
        h = 740,
        fill = pv.colors("lightblue", "darkgray", "lightpink");

    var vis = new pv.Panel()
        .width(w)
        .height(h)
        .margin(20)
        .right(40);

    var dataURL = "/apps/xyz/metrics/cc_debits?start_time=1+day+ago";
    $.getJSON(dataURL, function(data) {
      var variables = ["cc_debits"];

      (function() {
        data.forEach(function(d) { d.at = new Date(d.at); });
      })();

      var x = pv.Scale.linear(data, function(d) { return d.at; }).range(0, w - 40),
          y = pv.Scale.linear(0, 70000).range(0, h);

      vis.add(pv.Bar) // visible bar
        .data(data)
        .bottom(0)
        .width(function(d) { return 20; })
        .height(function(d) { return y(d.v); })
		    .left(function(d) { return x(d.at); })
        .title(function(d) { return d.v; })
        .def("i", -1)
        .event("mouseover", function() { return this.i(this.index); })
        .event("mouseout", function() { return this.i(-1); })
        .fillStyle(function() { return this.i() == this.index ? "yellow" : "lightgreen"; })
        .strokeStyle(function() { return this.fillStyle().darker(); });

      vis.add(pv.Label)
          .data(x.ticks())
          .left(x)
          .bottom(0)
          .textBaseline("top")
          .textMargin(5)
          .text(pv.Format.date("%H"));
      
      vis.add(pv.Rule)
          .data(y.ticks(10))
          .bottom(y)
          .strokeStyle(function(i) { return (i ? "rgba(255, 255, 255, .7)" : "black"); })
        .anchor("right").add(pv.Label)
          .textMargin(6);

      vis.render();
    });

    </script>
  </body>
</html>
